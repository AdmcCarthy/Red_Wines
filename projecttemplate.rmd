Investigating Red Wine dataset by Adam McCarthy
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}

library(ggplot2)
library(ggthemes)
library(scales)
library(extRemes)
library(sm)
library(gridExtra)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Load_the_Data}
setwd('./data')
# Load the Data
red_wine <- read.csv('wineQualityReds.csv')
setwd('..')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Process_the_Data}
# Create a new categorical variable for quality
red_wine['quality_c'] <- ifelse(red_wine$quality <= 5, "lower", "upper")

# To be able to represent quality as a categorical variable
#
# Assign a full range of levels to represent 0-10
# red_wine$quality <- factor(red_wine$quality)
# levels(red_wine$quality) <- c(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10)

# Assign categorical groups as levels
red_wine$quality_c <- factor(red_wine$quality_c)
```

> **Dataset**: Red wine dataset consiting of 1599 variants of the Portuguese "Vinho Verde" wine. Includes physicochemical (inputs) and sensory (the output) variables. This dataset is public available for research. The details are described in [Cortez et al., 2009].

# Univariate Plots Section

> **Overview**: There are 13 variables within the original dataset. Of these one is a
dependent variable giving a subjective measure of quality based on experts
sensory reviw of the wine. The main 11 variables are independent physiochemical
tests. These may be inter-related but are initially thought of as individual
measurements.

See [here](https://s3.amazonaws.com/udacity-hosted-downloads/ud651/wineQualityInfo.txt) for more information.

  
 * X - Each row of data, each wine type tested.    - Index
 
 Input variables (based on physicochemical tests):
 
 * 1 - fixed acidity, tartaric acid - $(g/dm^{3})$
 * 2 - volatile acidity, acetic acid - $(g/dm^{3})$
 * 3 - citric acid - $(g/dm^{3})$
 * 4 - residual sugar - $(g/dm^{3})$
 * 5 - chlorides, sodium chloride - $(g/dm^{3})$
 * 6 - free sulfur dioxide $(mg/dm^{3})$
 * 7 - total sulfur dioxide $(mg/dm^{3})$
 * 8 - density $(g/cm^{3})$
 * 9 - pH
 * 10 - sulphates, potassium sulphate - $(g/dm^{3})$
 * 11 - alcohol (% by volume)

 Output variable (based on sensory data):
 
 * 12 - quality (score between 0 and 10)
 * 13 - quality_c (quality grouped into lower and upper)

```{r echo=FALSE, Univariate_Plots}
summary(red_wine)
```

The summary table depicts descriptive statistics for all of the variables.

Quality is measured from 0-10 based. To plot effectively each 
element from 0-10 is included to ensure the representation of data 
is better presented. 
This variable has been reformatted to a factor with 11 levels (from orignal 6).

One categorical variables within the dataset is generated to
group quality into two categories. Lower (<=5) and Upper (>5).
This will be used to explore for any major differences in values.

Ph is on a scale of 0 to 14 (potential of hydrogen), 
all values here are acidic (<7) with the range
occuring between 2.7-4.

Alcholol is measured in percentages.

The other variables are all numeric data types.

There are no missing values within the dataset.

```{r echo=FALSE, Univariate_Plots_Quality, fig.height = 3, fig.width = 5, fig.align="center"}
ggplot(data=red_wine, aes(red_wine$quality)) + 
  geom_bar(fill="#9099A2") +
  theme_tufte() +
  labs(
    title="Distribution of Quality"
    ) +
  labs(
    x="Quality",
    y="Count"
    )
```

Quality is between 2 and 8 despite the scoring range being 0-10. The majority
of values are 5 and 6. There is skew to the right tail giving more positive
scores in 7. Giving the poor sampling of scores outside of 5 and 6 the quality
measure will be split into two categories, upper (>5) and lower (<=5).

```{r echo=FALSE, Univariate_Plots_multi_2, fig.height = 3, fig.width = 5, fig.align="center"}
small_hist <- function(data_v, name, scale, df=red_wine) {
plt <- ggplot(data = df, aes(data_v)) + 
  geom_histogram(bins = 50,
                 col = "white",
                 fill = "#9099A2"
                 ) +
  theme_tufte() +
  labs(
    title = name
    ) +
  labs(
    x = scale,
    y = "Count"
    )

return(plt)
}

plt10 <- small_hist(red_wine$alcohol, 
  "Alcohol", "%")

plt10
```

Alcohol also has a skewed distribution of values but with most values located
between 9% and 13%. A small histogram can give a quick impression of the
distribution of data more effectively than reading the descriptive statistics.

```{r echo=FALSE, Multiplot_function}
# Entirely taken from:
# http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_(ggplot2)/
# Multiple plot function
#
# ggplot objects can be passed in ..., or to plotlist (as a list of ggplot objects)
# - cols:   Number of columns in layout
# - layout: A matrix specifying the layout. If present, 'cols' is ignored.
#
# If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),
# then plot 1 will go in the upper left, 2 will go in the upper right, and
# 3 will go all the way across the bottom.
#
multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  library(grid)

  # Make a list from the ... arguments and plotlist
  plots <- c(list(...), plotlist)

  numPlots = length(plots)

  # If layout is NULL, then use 'cols' to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                    ncol = cols, nrow = ceiling(numPlots/cols))
  }

 if (numPlots==1) {
    print(plots[[1]])

  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))

    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))

      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}
```

```{r echo=FALSE, Univariate_Plots_multi, fig.height = 6, fig.width = 9}
plt1 <- small_hist(red_wine$fixed.acidity, "Fixed Acidity", "g/dm^3")
plt2 <- small_hist(red_wine$volatile.acidity, "Volatile Acidity", "g/dm^3")
plt3 <- small_hist(red_wine$citric.acid, "Citric Acidity", "g/dm^3")
plt4 <- small_hist(red_wine$residual.sugar, "Residual Sugar", "g/dm^3")
plt5 <- small_hist(red_wine$chlorides, "Chlorides", "g/dm^3")
plt6 <- small_hist(red_wine$pH, "pH", "pH scale")
plt7 <- small_hist(red_wine$free.sulfur.dioxide, 
  "Free Sulphar Dioxide", "mg/dm^3")
plt8 <- small_hist(red_wine$total.sulfur.dioxide, 
  "Total Sulphar Dioxide", "mg/dm^3")
plt9 <- small_hist(red_wine$density, 
  "Density", "g/dm^3")

multiplot(plt1, plt2, plt3, plt4, plt5, plt6, plt7, plt8, plt9, cols = 3)
```

Starting to investigate further variables a group of 9 measurements are placed
into histograms to understand their distributions. Of these pH, Fixed acidity
and Volatile Acidity have slightly normal distributions, these could be 
investigated further using quantile quantile plots.

Residual Sugar and Chlorides both appear to have highly skewed, over dispersed
data, these could be explored using a transformation to investigate the
distribution of values further.

Citric Acidity has two spikes, one occuring at 0 and one around 0.5. Bin size
could be changed to investigate if there is some artifact in the data related
to rounding.

Density appears relatively normal but 
with occasional spikes, these should be checked for rounding issues.

Free sulphar dioxide and total sulphar dioxide have skewed distributions, with
a sparse population of values towards the maximum.

```{r echo=FALSE, hist_pH, fig.height = 4, fig.width = 6, fig.align="center"}
hist(red_wine$pH,
     prob=TRUE,
     breaks=60,
     col='#9099A2',
     border="white",
     col.axis = '#9099A2',
     col.lab = '#9099A2',
     col.main = '#192231',
     bty = 'n')
lines(density(red_wine$pH),
      col='#192231', lwd=2)
lines(density(red_wine$pH, adjust=2), 
      lty="dotted", col='#192231', lwd=1)
rug(red_wine$pH, ticksize=0.02, side=1, lwd=0.2)
```

Two plots detailing pH value.

```{r echo=FALSE, QQ_pH, fig.height = 8, fig.width = 8, fig.align="center"}

qqnorm(red_wine$pH,
              main = 'pH QQ plot',
              bty = 'n',  # Frame style
              col = alpha('#192231', 0.3),  # transparency with col
              cex = .4,  # scale pof points
              col.axis = '#9099A2',
              col.lab = '#9099A2',
              col.main = '#192231',
              pch = 20  # point symbol type
)
qqline(red_wine$pH, col = '#9099A2', lty = 1)
```

Now using these two plots pH can be examined in greater detail. pH appears to 
have light tails as displayed by the overall sigmoidal shape of the points, 
it displays very fine grained clustering which is related to rounding of 
values and it shows an overall skew to the right.

Towards the upper right of the quantile quantile plot against a standard 
normal distribution the line crosses the 95% confidence intervals.

```{r echo=FALSE, QQ_den, fig.height = 4, fig.width = 4, fig.align="center"}

qqnorm(red_wine$density,
              main = 'Density QQ plot',
              bty = 'n',  # Frame style
              col = alpha('#192231', 0.3),  # transparency with col
              cex = .4,  # scale pof points
              col.axis = '#9099A2',
              col.lab = '#9099A2',
              col.main = '#192231',
              pch = 20  # point symbol type
)
qqline(red_wine$density, col = '#9099A2', lty = 1)
```

Density also shows light tails and skew to the right leading to the fit for
a normal distribution exisiting outside of the 95% confidence intervals.

```{R echo=FALSE, Log_hist, fig.height = 4, fig.width = 5}
plt11 <- ggplot(aes(x = red_wine$residual.sugar), data =red_wine) +
  geom_histogram(bins = 60,
                 col = "white",
                 fill = "#9099A2"
                 ) +
  theme_tufte() +
  labs(
    title = "Residual sugar"
    ) +
  labs(
    x = "g/dm^3",
    y = "Count"
    )
plt12 <- plt11 + scale_x_sqrt() +
    labs(title = "Residual sugar sqrt", x = "g/dm^3 sqrt")
plt13 <- plt11 + scale_x_log10() +
    labs(title = "Residual sugar log10", x = "g/dm^3 log10")

grid.arrange(plt11, plt12, plt13, ncol = 1)
```

To explore over disperssed variables data transformations can be applied.
The original plot followed by a square root and log10 data transformation is conducted on residual sugar in the above three plots. The data transformations
give a better representation of the distribution of values. They still have
long tails towards the right.

```{R echo=FALSE, Log_hists, fig.height = 6, fig.width = 5}
plt14 <- ggplot(aes(x = red_wine$chlorides), data = red_wine) +
  geom_histogram(bins = 60,
                 col = "white",
                 fill = "#9099A2"
                 ) +
  theme_tufte() +
  labs(
    title = "Chlorides log10"
    ) +
  labs(
    x = "g/dm^3 log10",
    y = "Count"
    ) + scale_x_log10()

plt15 <- ggplot(aes(x = red_wine$citric.acid), data = red_wine) +
  geom_histogram(bins = 60,
                 col = "white",
                 fill = "#9099A2"
                 ) +
  theme_tufte() +
  labs(
    title = "Citric Acid sqrt"
    ) +
  labs(
    x = "g/dm^3 sqrt",
    y = "Count"
    ) + scale_x_sqrt()

plt16 <- ggplot(aes(x = red_wine$total.sulfur.dioxide), data = red_wine) +
  geom_histogram(bins = 60,
                 col = "white",
                 fill = "#9099A2"
                 ) +
  theme_tufte() +
  labs(
    title = "Total sulfur dioxide log10"
    ) +
  labs(
    x = "g/dm^3 log10",
    y = "Count"
    ) + scale_x_log10()

plt17 <- ggplot(aes(x = red_wine$free.sulfur.dioxide), data = red_wine) +
  geom_histogram(bins = 60,
                 col = "white",
                 fill = "#9099A2"
                 ) +
  theme_tufte() +
  labs(
    title = "Free Sulfur Dioxide sqrt"
    ) +
  labs(
    x = "g/dm^3 sqrt",
    y = "Count"
    ) + scale_x_sqrt()

grid.arrange(plt14, plt15, plt16, plt17, ncol = 1)
```

Other over disperssed variables are explored in the above plot and each is
matched to a data transformation that better represents 
the distribution of data values. Chlorides shows a slightly normal distribution
with a long tail to the right, it is centered nicely after a 
log10 transformation.

Citric acid still has a large count of values at close to 0, the data
distribution is best represented using a square root transformation, this
does not bring the data closer to a normal distribution but represents
the the distribution of values across the range.

Total sulfur dioxide is transformed using log10 given a wide normal
styled distribution.

Free sulfure dioxide puts too many values to the right hand side during a
log10 transformation so even with a skew, square root gives a better
distribution of values.

Each of these transformations can be used when comparing these variables
to other variables.

# Univariate Analysis

> **Tip**: Now that you've completed your univariate explorations, it's time to
reflect on and summarize what you've found. Use the questions below to help you
gather your observations and add your own if you have other thoughts!

### What is the structure of your dataset?

### What is/are the main feature(s) of interest in your dataset?

### What other features in the dataset do you think will help support your \
investigation into your feature(s) of interest?

### Did you create any new variables from existing variables in the dataset?

### Of the features you investigated, were there any unusual distributions? \
Did you perform any operations on the data to tidy, adjust, or change the form \
of the data? If so, why did you do this?


# Bivariate Plots Section

> **Tip**: Based on what you saw in the univariate plots, what relationships
between variables might be interesting to look at in this section? Don't limit
yourself to relationships between a main output feature and one of the
supporting variables. Try to look at relationships between supporting variables
as well.

```{r echo=FALSE, Bivariate_Plots}

```

```{r echo=FALSE, biv_hist, fig.height = 2, fig.width = 4, fig.align="center"}
sm.density.compare(red_wine$alcohol, red_wine$quality_c)
```

```{r echo=FALSE, Bivariate_Plots_pH}
ggplot(data=red_wine, aes(red_wine$pH)) + 
  geom_histogram(bins=50, 
                 col="white", 
                 fill="#9099A2"
                 ) +
  theme_tufte() +
  labs(
    title="Histogram for pH"
    ) +
  labs(
    x="pH", 
    y="Count"
    ) +
  facet_wrap(~quality_c, ncol = 1)
```

# Bivariate Analysis

> **Tip**: As before, summarize what you found in your bivariate explorations
here. Use the questions below to guide your discussion.

### Talk about some of the relationships you observed in this part of the \
investigation. How did the feature(s) of interest vary with other features in \
the dataset?

### Did you observe any interesting relationships between the other features \
(not the main feature(s) of interest)?

### What was the strongest relationship you found?


# Multivariate Plots Section

> **Tip**: Now it's time to put everything together. Based on what you found in
the bivariate plots section, create a few multivariate plots to investigate
more complex interactions between variables. Make sure that the plots that you
create here are justified by the plots you explored in the previous section. If
you plan on creating any mathematical models, this is the section where you
will do that.

```{r echo=FALSE, Multivariate_Plots}

```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the \
investigation. Were there features that strengthened each other in terms of \
looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the \
strengths and limitations of your model.

------

# Final Plots and Summary

> **Tip**: You've done a lot of exploration and have built up an understanding
of the structure of and relationships between the variables in your dataset.
Here, you will select three plots from all of your previous exploration to
present here as a summary of some of your most interesting findings. Make sure
that you have refined your selected plots for good titling, axis labels (with
units), and good aesthetic choices (e.g. color, transparency). After each plot,
make sure you justify why you chose each plot by describing what it shows.

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection

> **Tip**: Here's the final step! Reflect on the exploration you performed and
the insights you found. What were some of the struggles that you went through?
What went well? What was surprising? Make sure you include an insight into
future work that could be done with the dataset.

> **Tip**: Don't forget to remove this, and the other **Tip** sections before
saving your final work and knitting the final report!

# Resources used
P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis. 
Modeling wine preferences by data mining from physicochemical properties.
In Decision Support Systems, Elsevier, 47(4):547-553. ISSN: 0167-9236.
Available at: [@Elsevier](http://dx.doi.org/10.1016/j.dss.2009.05.016)
                [Pre-press (pdf)](http://www3.dsi.uminho.pt/pcortez/winequality09.pdf)
              [bib](http://www3.dsi.uminho.pt/pcortez/dss09.bib)
                
[ggthemes](https://cran.r-project.org/web/packages/ggthemes/vignettes/ggthemes.html)